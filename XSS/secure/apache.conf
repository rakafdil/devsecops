ServerRoot "/usr/local/apache2"
Listen 80

# Basic modules
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule php_module modules/libphp.so
LoadModule headers_module modules/mod_headers.so

# Security modules
LoadModule security2_module modules/mod_security2.so

# Basic configuration
ServerName localhost
DirectoryIndex index.php index.html

# Document root
DocumentRoot "/var/www/html"

<Directory "/var/www/html">
    Options -Indexes -FollowSymLinks
    AllowOverride All
    Require all granted
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # CSP header will be set by PHP application
    # Header always set Content-Security-Policy "default-src 'self'"
    
    # Remove server signature
    Header always unset Server
    Header always unset X-Powered-By
</Directory>

# PHP configuration
<FilesMatch \.php$>
    SetHandler application/x-httpd-php
</FilesMatch>

# MIME types
TypesConfig conf/mime.types

# Security: Hide .env files
<Files ".env*">
    Require all denied
</Files>

# Security: Hide composer files
<Files "composer.*">
    Require all denied
</Files>

# Security: Hide git files
<DirectoryMatch "\.git">
    Require all denied
</DirectoryMatch>

# Security: Prevent access to backup files
<FilesMatch "\.(bak|backup|old|orig|save|swp|tmp)$">
    Require all denied
</FilesMatch>

# Log configuration
ErrorLog /dev/stderr
TransferLog /dev/stdout
LogLevel warn

# Server tokens (security)
ServerTokens Prod
ServerSignature Off

# Additional security settings
TraceEnable Off
Timeout 60
MaxRequestWorkers 256